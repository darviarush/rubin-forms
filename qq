#!perl


BEGIN {
	use Carp 'verbose';
	$SIG{ __DIE__ } = \&Carp::confess;
	#use Devel::Confess  qw/color/;
	use Cwd qw/cwd/;
	use Data::Dumper;
}

use File::Basename qw/dirname/;
#chdir dirname($0);
my $framework_dir = dirname($0)."/../rubin";
use lib dirname($0)."/lib";
use lib dirname($0)."/../rubin/lib";
use Msg;
use Utils;
our $ini = Utils::parse_ini("main.ini");
if($ini) {
	require Connect;
}

my @av = @ARGV;
_START_:
@av = "qq" unless @av;
my $path = "bin/$av[0].pl";
my $ret;
if(-e $path) { $ret = do $path; }
elsif(-e "$framework_dir/$path") { $ret = do "$framework_dir/$path"; }
else { die "Команда `$path` не найдена" }

if(my $error = $@ // $!) { die $error }

if(ref $ret ne "ARRAY") { return 1; } else { @av = @$ret; goto _START_; }

1;